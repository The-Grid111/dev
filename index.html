<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>THEGRID — Black & Gold</title>
<meta name="theme-color" content="#0b0b0f"/>
<link rel="preload" href="assets/videos/hero_1.mp4" as="video">
<style>
  :root{
    --accent:#E7B84B;
    --accent2:#9bb7ff;
    --panel:#101218;
    --card:#12141b;
    --ink:#e9ecf3;
    --soft:#b9c0cf;
    --ring: 22;          /* border glow 0–100 */
    --radius:20px;
    --fontScale:1;       /* 0.9–1.2 */
    --space:1;           /* 0.9–1.2 */
    --borderStyle: glow; /* none | solid | glow */
    --vignette: 1;       /* 0 off / 1 on */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font: 400 calc(18px*var(--fontScale))/1.55 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--ink); background:#0b0c10;
    letter-spacing:.2px; --pad: calc(14px * var(--space));
  }

  /* ------- Background layer ------- */
  #bg{position:fixed;inset:0;z-index:-1;overflow:hidden;background:#07080b}
  #bgVid{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.26;filter:blur(6px) saturate(1.1) brightness(.6);display:none}
  body.has-gradient #bg{background:
    radial-gradient(1200px 800px at 15% -10%, rgba(231,184,75,.12), transparent 60%),
    radial-gradient(1200px 800px at 85% 110%, rgba(231,184,75,.10), transparent 60%),
    linear-gradient(180deg, #0b0c11 0%, #0a0b0f 100%)}
  body.has-pattern #bg:after{
    content:""; position:absolute; inset:0; opacity:.12; pointer-events:none;
    background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,.08) 1px, transparent 1px);
    background-size:22px 22px; filter:contrast(120%)
  }
  #bgDust{position:absolute;inset:0;opacity:.14}

  .vignette:before{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(1200px 600px at 50% -200px, #0000 30%, rgba(231,184,75,.18) 55%, #0000 70%),
      radial-gradient(1400px 900px at 50% 120%, #0000 30%, rgba(231,184,75,.12) 70%, #0000 80%),
      radial-gradient(1200px 600px at -200px 50%, #0000 30%, rgba(231,184,75,.12) 55%, #0000 70%),
      radial-gradient(1200px 600px at calc(100% + 200px) 50%, #0000 30%, rgba(231,184,75,.12) 55%, #0000 70%);
    opacity: calc(.55 * var(--vignette));
  }

  .wrap{max-width:980px;margin-inline:auto;padding:24px}
  header{
    position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(10px);
    background:color-mix(in srgb, #0b0c10 78%, #000 22%); border-bottom:1px solid #151822;
  }
  .bar{display:flex;align-items:center;gap:14px; padding:16px 22px}
  .brand{display:flex;gap:12px;align-items:center; min-width:0}
  .logo{width:44px; height:44px; border-radius:12px; overflow:hidden; background:#0c0f14; box-shadow:0 0 0 1px #1a1f2c inset,0 0 20px rgba(231,184,75,.15); position:relative}
  .logo video,.logo img{width:100%;height:100%;object-fit:cover; display:block}
  .brand h1{font:800 22px/1.2 inherit; margin:0; letter-spacing:.2px}
  .brand small{display:block; color:var(--soft); font-size:.82em}
  .spacer{flex:1}
  .btn{appearance:none; border:0; border-radius:12px; padding:12px 16px; font:600 16px/1 inherit; background:#161a24; color:var(--ink); box-shadow:0 0 0 1px #232838 inset; transition:transform .12s ease, box-shadow .2s ease, background .2s ease; cursor:pointer}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background: linear-gradient(180deg, color-mix(in srgb, var(--accent), #fff 12%) 0%, var(--accent) 100%); color:#1a1300; box-shadow: 0 8px 28px rgba(231,184,75,.25), 0 0 0 1px color-mix(in srgb, var(--accent), #000 45%) inset}

  section{margin:28px 0}
  .card{background:linear-gradient(180deg, #151925, #0F1219); border-radius:var(--radius); padding:calc(var(--pad)*1.2); position:relative; box-shadow: 0 0 0 1px #1b2130 inset, 0 8px 40px rgba(0,0,0,.45), 0 0 0 calc(var(--ring) * .12px) color-mix(in srgb, var(--accent), transparent 90%)}
  h2{font:800 clamp(28px,5vw,44px)/1.15 ui-sans-serif,system-ui;margin:0 0 8px}
  .lede{color:var(--soft); margin:0 0 18px}

  /* Hero */
  .heroFrame{aspect-ratio:16/9; border-radius:calc(var(--radius) - 6px); background:#0d1016; display:grid; place-items:center; box-shadow:0 0 0 2px #202636 inset; border: 1px dashed #2a3142}
  .heroFrame video,.heroFrame img{width:100%;height:100%;object-fit:cover;border-radius:inherit;display:block}
  .ctaRow{display:flex; gap:12px; margin-top:14px; flex-wrap:wrap}
  .ctaRow .btn{padding:12px 18px}

  /* Library */
  .tabs{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px}
  .pill{padding:10px 14px; border-radius:999px; background:#0f141d; color:var(--ink); box-shadow:0 0 0 1px #252c3c inset; cursor:pointer; user-select:none}
  .pill.active{box-shadow:0 0 0 2px var(--accent) inset; background: #151a24}
  .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(230px,1fr))}
  .tile{padding:14px; border-radius:14px; background:#0f1218; border:1px dashed #2a3142; color:#c4cbda; cursor:pointer}
  .tile:hover{box-shadow:0 0 0 2px var(--accent) inset}
  .tile.is-active{box-shadow:0 0 0 2px var(--accent) inset, 0 8px 24px rgba(0,0,0,.4)}
  .meta{font-size:.9em; color:#93a0b8}

  /* Pricing */
  .plan{display:grid; gap:10px; padding:18px; border-radius:16px; background:#11141b; box-shadow:0 0 0 1px #1c2130 inset}
  .plan .head{display:flex; justify-content:space-between; align-items:center}
  .badge{border-radius:999px; padding:6px 10px; font:700 12px/1 ui-sans-serif; letter-spacing:.7px;color:#0c1017; background: color-mix(in srgb, var(--accent), #fff 20%); box-shadow:0 0 0 1px #2b2110 inset}
  .price{font:800 34px/1.1 ui-sans-serif}
  .plan ul{margin:0 0 4px 18px}
  .plan .row{display:flex; gap:10px}
  .plan .btn{flex:1}
  .plan .ghost{background:#0f141d;color:#d7dbea}

  form{display:grid;gap:10px}
  input,textarea{width:100%; padding:12px 14px; border-radius:12px; border:1px solid #22283a; background:#0e1218; color:var(--ink)}
  textarea{min-height:130px; resize:vertical}

  dialog{border:0; border-radius:16px; background:#0f1219; color:var(--ink); padding:0; width:min(680px,90vw)}
  dialog::backdrop{background:rgba(0,0,0,.6)}
  .modalHead{display:flex;justify-content:space-between;align-items:center;padding:16px 18px;border-bottom:1px solid #1d2331}
  .modalBody{padding:18px}
  .x{background:#141926}

  .solid .card, .solid .plan{box-shadow:0 0 0 1px color-mix(in srgb, var(--accent), #000 40%) inset}
  .none .card, .none .plan{box-shadow:0 8px 40px rgba(0,0,0,.45), 0 0 0 1px #1b2130 inset}
  .muted{color:var(--soft)}
</style>
</head>
<body class="vignette has-gradient" id="app">

<!-- Background -->
<div id="bg" aria-hidden="true">
  <video id="bgVid" muted loop playsinline></video>
  <canvas id="bgDust"></canvas>
</div>

<header>
  <div class="bar wrap">
    <div class="brand">
      <div class="logo" aria-label="Brand">
        <video id="logoVid" muted autoplay loop playsinline></video>
      </div>
      <div>
        <h1 id="hello">Good day — THEGRID</h1>
        <small>Black & Gold</small>
      </div>
    </div>
    <div class="spacer"></div>
    <button id="btnCustomize" class="btn">Customize</button>
    <button class="btn primary" id="btnJoin">Join Now</button>
  </div>
</header>

<main class="wrap">
  <!-- HERO -->
  <section class="card">
    <h2 id="heroTitle">Black & Gold</h2>
    <p class="lede">Cinematic visuals. Owner controls. One-file updates with a premium finish.</p>
    <div id="hero" class="heroFrame" aria-label="Hero media"></div>
    <div class="ctaRow">
      <a href="#library" class="btn">Open Library</a>
      <a href="#plans" class="btn primary">See Pricing</a>
    </div>
  </section>

  <!-- LIBRARY -->
  <section id="library" class="card">
    <h2>Library</h2>
    <p class="lede">Tap a tile to set media. Drop files into <b>assets/videos</b> or <b>assets/images</b>. Optional: add <b>assets/manifest.json</b> to list more.</p>
    <div class="tabs" id="libTabs"></div>
    <div class="grid" id="libGrid" aria-live="polite"></div>
    <p class="meta">Tip: name files clearly (e.g. <i>hero_1.mp4</i>, <i>reel_9x16_a.mp4</i>). The list auto-loads from <b>assets/manifest.json</b> when present.</p>
  </section>

  <!-- PLANS -->
  <section id="plans" class="card">
    <h2>Plans</h2>
    <p class="lede">Fair pricing. No lock-in. 7-day refund.</p>
    <div class="grid">
      <article class="plan" data-tier="basic">
        <div class="head"><div class="price">£9<span class="muted">/mo</span></div><span class="badge">BASIC</span></div>
        <ul><li>Starter templates</li><li>Library access</li><li>Email support (48h)</li></ul>
        <div class="row">
          <button class="btn primary choose">Choose</button>
          <button class="btn ghost details">Details</button>
        </div>
      </article>

      <article class="plan" data-tier="silver">
        <div class="head"><div class="price">£29<span class="muted">/mo</span></div><span class="badge">SILVER</span></div>
        <ul><li>Everything in Basic</li><li>Advanced effects</li><li>Priority support (24h)</li></ul>
        <div class="row">
          <button class="btn primary choose">Choose</button>
          <button class="btn ghost details">Details</button>
        </div>
      </article>

      <article class="plan" data-tier="gold">
        <div class="head"><div class="price">£49<span class="muted">/mo</span></div><span class="badge">GOLD</span></div>
        <ul><li>Full customization</li><li>Admin toolkit</li><li>1:1 onboarding</li></ul>
        <div class="row">
          <button class="btn primary choose">Choose</button>
          <button class="btn ghost details">Details</button>
        </div>
      </article>

      <article class="plan" data-tier="diamond">
        <div class="head"><div class="price">£99<span class="muted">/mo</span></div><span class="badge">DIAMOND</span></div>
        <ul><li>Custom pipelines</li><li>Hands-on help</li><li>Priority roadmap</li></ul>
        <div class="row">
          <button class="btn primary choose">Choose</button>
          <button class="btn ghost details">Details</button>
        </div>
      </article>
    </div>

    <p class="meta" style="margin-top:10px">All plans billed monthly. Cancel anytime. Prices are fair-value — adjust in Customize.</p>
  </section>
    <!-- À-la-carte -->
  <section class="card">
    <h2>À-la-carte Services</h2>
    <div class="grid">
      <article class="plan">
        <div class="head"><div class="price" style="font-size:28px">£39</div><span class="badge">SETUP</span></div>
        <ul><li>Deploy & connect Pages</li><li>Analytics hookup</li><li>Best-practice sweep</li></ul>
        <button class="btn primary">Start Setup</button>
      </article>
      <article class="plan">
        <div class="head"><div class="price" style="font-size:28px">£59</div><span class="badge">REELS</span></div>
        <ul><li>3 niche reels</li><li>Captions & cuts</li><li>IG/TikTok ready</li></ul>
        <button class="btn primary">Order Pack</button>
      </article>
      <article class="plan">
        <div class="head"><div class="price" style="font-size:28px">£29</div><span class="badge">TEMPLATES</span></div>
        <ul><li>5 premium blocks</li><li>Copy-paste ready</li><li>Lifetime updates</li></ul>
        <button class="btn primary">Get Pack</button>
      </article>
    </div>
  </section>

  <!-- CONTACT -->
  <section class="card">
    <h2>Contact</h2>
    <form onsubmit="event.preventDefault(); alert('Thanks — we will reply from gridcoresystems@gmail.com'); this.reset()">
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <input placeholder="Your name" required>
        <input type="email" placeholder="you@example.com" required>
      </div>
      <input placeholder="How can we help?">
      <textarea placeholder="Write your message…"></textarea>
      <button class="btn primary" style="width:180px">Send</button>
      <p class="meta">Replies from <b>gridcoresystems@gmail.com</b>. No spam, no sharing.</p>
    </form>
  </section>
</main>

<!-- DETAILS MODAL -->
<dialog id="planModal">
  <div class="modalHead">
    <strong id="mTitle">Plan details</strong>
    <button class="btn x" onclick="planModal.close()">Close</button>
  </div>
  <div class="modalBody" id="mBody"></div>
</dialog>

<!-- CUSTOMIZE PANEL -->
<dialog id="panel">
  <div class="modalHead"><strong>Design Panel</strong><button class="btn x" onclick="panel.close()">Close</button></div>
  <div class="modalBody">
    <div class="grid" style="grid-template-columns:1fr 1fr">
      <label>Accent color<br><input id="uiAccent" type="color" value="#E7B84B" style="width:100%;height:42px;border:0;background:transparent"></label>
      <label>Secondary accent<br><input id="uiAccent2" type="color" value="#9bb7ff" style="width:100%;height:42px;border:0;background:transparent"></label>

      <label>Text color<br><input id="uiInk" type="color" value="#e9ecf3" style="width:100%;height:42px;border:0;background:transparent"></label>
      <label>Soft text<br><input id="uiSoft" type="color" value="#b9c0cf" style="width:100%;height:42px;border:0;background:transparent"></label>

      <label>Card radius<br><input id="uiRadius" type="range" min="6" max="28" value="20" style="width:100%"></label>
      <label>Border Glow (0–100)<br><input id="uiRing" type="range" min="0" max="100" value="22" style="width:100%"></label>

      <label>Border style<br>
        <select id="uiBorder" style="width:100%;padding:10px;border-radius:10px;background:#0e1217;color:var(--ink);border:1px solid #22283a">
          <option value="glow">Glow</option><option value="solid">Solid</option><option value="none">None</option>
        </select>
      </label>
      <label>Vignette<br>
        <select id="uiVignette" style="width:100%;padding:10px;border-radius:10px;background:#0e1217;color:var(--ink);border:1px solid #22283a">
          <option value="1">On</option><option value="0">Off</option>
        </select>
      </label>

      <label>Font size<br><input id="uiFont" type="range" min="0.9" max="1.2" step=".01" value="1" style="width:100%"></label>
      <label>Spacing<br><input id="uiSpace" type="range" min="0.9" max="1.2" step=".01" value="1" style="width:100%"></label>

      <label>Hero source<br>
        <select id="uiHero" style="width:100%;padding:10px;border-radius:10px;background:#0e1217;color:var(--ink);border:1px solid #22283a"></select>
      </label>
      <label>Background mode<br>
        <select id="uiBgMode" style="width:100%;padding:10px;border-radius:10px;background:#0e1217;color:var(--ink);border:1px solid #22283a">
          <option value="gradient">Gradient</option>
          <option value="pattern">Gradient + Pattern</option>
          <option value="video">Video</option>
        </select>
      </label>
      <label>Background video<br>
        <select id="uiBgSrc" style="width:100%;padding:10px;border-radius:10px;background:#0e1217;color:var(--ink);border:1px solid #22283a"></select>
      </label>
    </div>

    <h3 style="margin-top:16px">Confetti</h3>
    <div class="grid" style="grid-template-columns:1fr 1fr">
      <label>Density<br><input id="uiConfettiDensity" type="range" min="10" max="100" value="36" style="width:100%"></label>
      <label>Speed<br><input id="uiConfettiSpeed" type="range" min="0.3" max="2" step=".05" value="1.1" style="width:100%"></label>
    </div>

    <div class="ctaRow" style="margin-top:16px">
      <button id="save" class="btn">Save to this device</button>
      <button id="reset" class="btn x">Reset</button>
    </div>
  </div>
</dialog>

<!-- Confetti canvas -->
<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
/* ---------- Helpers & State ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const state = {
  accent: getCSS('--accent'),
  accent2: getCSS('--accent2'),
  ring: +getCSS('--ring'),
  radius: parseInt(getCSS('--radius')),
  border: 'glow',
  font: +getCSS('--fontScale'),
  space: +getCSS('--space'),
  vignette: +getCSS('--vignette'),
  heroSrc: 'assets/videos/hero_1.mp4',
  confetti: {density:36, speed:1.1},
  bg: { mode:'gradient', src:'assets/videos/gc_spin.mp4', dust:true },
  library: { Hero:[], 'Reels 9:16':[], 'Reels 16:9':[], Backgrounds:[], Logos:[], Images:[] }
};
function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim() }
function setCSS(v,val){ document.documentElement.style.setProperty(v,val) }
function save(){ localStorage.setItem('thegrid.settings', JSON.stringify(state)) }
function load(){
  const s = JSON.parse(localStorage.getItem('thegrid.settings')||'null');
  if(!s) return;
  Object.assign(state, s);
  applyState();
}

/* ---------- Greeting & logo ---------- */
(function greeting(){
  const h = new Date().getHours();
  const word = h<12?'Good morning':h<18?'Good afternoon':'Good evening';
  $('#hello').textContent = `${word} — THE GRID`;
})();
(function logo(){
  const v = $('#logoVid');
  v.src = 'assets/videos/gc_spin.mp4';
  v.onerror = () => { v.replaceWith(Object.assign(document.createElement('img'),{src:'assets/images/gc_logo.png',alt:'Logo'})); };
})();

/* ---------- Hero ---------- */
function setHero(src){
  state.heroSrc = src; save(); renderHero();
}
function renderHero(){
  const box = $('#hero'); box.innerHTML = '';
  if(/\.(mp4|webm|mov)$/i.test(state.heroSrc)){
    const v = Object.assign(document.createElement('video'), {src:state.heroSrc, controls:true, playsInline:true});
    box.appendChild(v);
  }else{
    const i = Object.assign(document.createElement('img'), {src:state.heroSrc, alt:'hero'});
    box.appendChild(i);
  }
}

/* ---------- Library (reads assets/manifest.json when present) ---------- */
const defaultManifest = {
  "Hero":[
    "assets/videos/hero_1.mp4","assets/videos/interaction_1.mp4",
    "assets/videos/pour_1.mp4","assets/images/hero_1.jpg",
    "assets/images/hero_2.jpg","assets/images/hero_3.jpg"
  ],
  "Reels 9:16":[],
  "Reels 16:9":[],
  "Backgrounds":["assets/videos/gc_spin.mp4"],
  "Logos":["assets/images/gc_logo.png"],
  "Images":["assets/images/hero_1.jpg","assets/images/hero_2.jpg","assets/images/hero_3.jpg"]
};
async function loadManifest(){
  try{
    const res = await fetch('assets/manifest.json',{cache:'no-store'});
    if(res.ok){ Object.assign(state.library, await res.json()); }
    else { Object.assign(state.library, defaultManifest); }
  }catch{ Object.assign(state.library, defaultManifest); }
  buildLibrary();
  populateHeroSelect();
  populateBgSelect();
}

function buildLibrary(){
  const tabs = $('#libTabs'); tabs.innerHTML='';
  const grid = $('#libGrid'); grid.innerHTML='';
  const cats = Object.keys(state.library);
  let active = localStorage.getItem('thegrid.activeTab') || cats[0];

  cats.forEach(cat=>{
    const pill = Object.assign(document.createElement('div'),{className:'pill'+(cat===active?' active':''),textContent:cat});
    pill.onclick = ()=>{ localStorage.setItem('thegrid.activeTab',cat); buildLibrary(); };
    tabs.appendChild(pill);
  });

  state.library[active].forEach(src=>{
    const act = (active==='Hero' && state.heroSrc===src) || (active==='Backgrounds' && state.bg.src===src);
    const t = Object.assign(document.createElement('div'),{
      className:'tile'+(act?' is-active':''), 
      innerHTML:`<b>${src.split('/').pop()}</b><div class="meta">${src}</div>`
    });
    t.onclick=()=>{
      if(active==='Hero') setHero(src);
      if(active==='Backgrounds'){ state.bg.mode='video'; state.bg.src=src; save(); renderBackground(); }
      buildLibrary();
    };
    grid.appendChild(t);
  });
}
function populateHeroSelect(){
  const sel = $('#uiHero'); sel.innerHTML='';
  const all = [...new Set(Object.values(state.library).flat())].filter(Boolean);
  all.forEach(src=> sel.add(new Option(src, src, src===state.heroSrc, src===state.heroSrc)));
}
function populateBgSelect(){
  const sel = $('#uiBgSrc'); if(!sel) return;
  const vids = [...new Set(Object.values(state.library).flat())].filter(x=>/\.(mp4|webm|mov)$/i.test(x));
  sel.innerHTML=''; vids.forEach(src=> sel.add(new Option(src, src, src===state.bg.src, src===state.bg.src)));
}

/* ---------- Customize Panel ---------- */
$('#btnCustomize').onclick = ()=>panel.showModal();
$('#save').onclick = ()=>{ save(); alert('Saved to this device.'); };
$('#reset').onclick = ()=>{ localStorage.removeItem('thegrid.settings'); location.reload(); };

$('#uiAccent').oninput = e=>{ state.accent=e.target.value; setCSS('--accent',state.accent); save() };
$('#uiAccent2').oninput = e=>{ state.accent2=e.target.value; setCSS('--accent2',state.accent2); save() };
$('#uiInk').oninput = e=>{ state.ink=e.target.value; setCSS('--ink',state.ink); save() };
$('#uiSoft').oninput = e=>{ state.soft=e.target.value; setCSS('--soft',state.soft); save() };
$('#uiRing').oninput = e=>{ state.ring=+e.target.value; setCSS('--ring',state.ring); save() };
$('#uiRadius').oninput = e=>{ state.radius=+e.target.value; setCSS('--radius', state.radius+'px'); save() };
$('#uiFont').oninput = e=>{ state.font=+e.target.value; setCSS('--fontScale', state.font); save() };
$('#uiSpace').oninput = e=>{ state.space=+e.target.value; setCSS('--space', state.space); save() };
$('#uiBorder').oninput = e=>{ state.border=e.target.value; document.body.classList.remove('solid','none','glow'); document.body.classList.add(state.border); save() };
$('#uiVignette').oninput = e=>{ state.vignette=+e.target.value; setCSS('--vignette', state.vignette); save() };
$('#uiHero').oninput = e=> setHero(e.target.value);
$('#uiBgMode').oninput = e=>{ state.bg.mode=e.target.value; save(); applyState(); };
$('#uiBgSrc').oninput  = e=>{ state.bg.src=e.target.value; state.bg.mode='video'; save(); applyState(); };

/* ---------- Background (video/gradient/pattern + dust) ---------- */
function renderBackground(){
  const v = $('#bgVid');
  if(state.bg.mode==='video'){
    v.src = state.bg.src; v.style.display='block';
  }else{
    v.removeAttribute('src'); v.style.display='none';
  }
  const dust = $('#bgDust'), dctx = dust.getContext('2d');
  function sizeDust(){ dust.width=innerWidth*devicePixelRatio; dust.height=innerHeight*devicePixelRatio }
  sizeDust(); addEventListener('resize', sizeDust);
  let flakes = new Array(60).fill(0).map(()=>({
    x: Math.random()*dust.width, y: Math.random()*dust.height,
    r: .6 + Math.random()*1.8, a: Math.random()*Math.PI*2, s: .2 + Math.random()*0.6
  }));
  (function loop(){
    dctx.clearRect(0,0,dust.width,dust.height);
    dctx.fillStyle = state.accent; dctx.globalAlpha = .35;
    flakes.forEach(f=>{
      f.x += Math.cos(f.a)*f.s; f.y += Math.sin(f.a*.5)*f.s; f.a += .002;
      if(f.x<0) f.x=dust.width; if(f.x>dust.width) f.x=0;
      if(f.y<0) f.y=dust.height; if(f.y>dust.height) f.y=0;
      dctx.beginPath(); dctx.arc(f.x,f.y,f.r,0,Math.PI*2); dctx.fill();
    });
    requestAnimationFrame(loop);
  })();
}

/* ---------- Pricing: Details + Confetti ---------- */
const DETAILS = {
  basic:`<h3>Who it’s for</h3><p>Creators getting started or teams who want a clean base fast.</p>
         <h3>What you get</h3><ul>
           <li>Starter site templates and blocks</li>
           <li>Access to the media library (videos, images, logos)</li>
           <li>Email support within 48h</li>
           <li>7-day refund guarantee</li>
           <li>Upgrade anytime — keep your settings, no rebuilds</li>
         </ul>`,
  silver:`<h3>Who it’s for</h3><p>Growing creators who want better visuals and faster support.</p>
          <h3>What you get</h3><ul>
            <li>Everything in Basic</li>
            <li>Advanced visual effects & presets</li>
            <li>Priority email support within 24h</li>
            <li>Quarterly tune-ups</li>
          </ul>`,
  gold:`<h3>Who it’s for</h3><p>Teams that need hands-on help and admin tools.</p>
        <h3>What you get</h3><ul>
          <li>Hands-on customization session</li>
          <li>Admin toolkit & automation setup</li>
          <li>Onboarding call (45 min)</li>
          <li>Template & block requests</li>
        </ul>`,
  diamond:`<h3>Who it’s for</h3><p>Creators/businesses needing custom pipelines and priority turnaround.</p>
          <h3>What you get</h3><ul>
            <li>Custom pipelines & integrations</li>
            <li>Hands-on help building your stack</li>
            <li>Priority roadmap & turnaround</li>
            <li>Private components when needed</li>
          </ul>`
};
$$('.details').forEach(b=>{
  b.onclick = e=>{
    const card = e.currentTarget.closest('.plan');
    const tier = card.dataset.tier;
    $('#mTitle').textContent = tier.toUpperCase() + ' plan';
    $('#mBody').innerHTML = DETAILS[tier] + `<div class="ctaRow"><button class="btn primary" onclick="planModal.close()">Sounds good</button></div>`;
    planModal.showModal();
  };
});
$$('.choose').forEach(b=>{
  b.onclick = e=>{
    const card = e.currentTarget.closest('.plan');
    confettiBurst(card);
    card.scrollIntoView({behavior:'smooth', block:'center'});
  };
});

/* ---------- Confetti (from both sides, crisper) ---------- */
const canvas = $('#fx'), ctx = canvas.getContext('2d'); let W,H, parts=[];
function size(){ W=canvas.width=innerWidth*devicePixelRatio; H=canvas.height=innerHeight*devicePixelRatio; }
addEventListener('resize', size); size();
function confettiBurst(el){
  const r = el.getBoundingClientRect();
  const y = (r.top + r.height*.3)*devicePixelRatio;
  const left = (r.left-8)*devicePixelRatio, right=(r.right+8)*devicePixelRatio;
  const n = Math.max(24, state.confetti.density|0), s = +state.confetti.speed;
  const colors=[state.accent,'#ffffff', getCSS('--accent2')||state.accent2, '#cbd4ea'];
  for(let i=0;i<n;i++){ parts.push(makePiece(left,y,1,s,colors)); parts.push(makePiece(right,y,-1,s,colors)); }
}
function makePiece(x,y,dir,s,colors){
  const shapes=['rect','tri']; const shape=shapes[(Math.random()*shapes.length)|0];
  const size = 4 + Math.random()*8;
  return {x,y, vx:(1+Math.random()*2)*dir*s, vy:(-3-Math.random()*2)*s, g:.08*s, r:Math.random()*Math.PI, shape, w:size, h:size*.7, life:180+Math.random()*60, c:colors[(Math.random()*colors.length)|0]};
}
function tick(){
  ctx.clearRect(0,0,W,H);
  parts = parts.filter(p=>p.life>0);
  parts.forEach(p=>{
    p.vy += p.g; p.x += p.vx; p.y += p.vy; p.r += .14; p.life--;
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r); ctx.fillStyle=p.c; ctx.globalAlpha=Math.max(.06, p.life/220);
    if(p.shape==='tri'){ ctx.beginPath(); ctx.moveTo(-p.w/2,p.h/2); ctx.lineTo(p.w/2,p.h/2); ctx.lineTo(0,-p.h/2); ctx.closePath(); ctx.fill(); }
    else { ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); }
    ctx.restore();
  });
  requestAnimationFrame(tick);
}
tick();

/* ---------- Apply state + init ---------- */
function applyState(){
  setCSS('--accent', state.accent);
  setCSS('--accent2', state.accent2);
  setCSS('--ink', state.ink || getCSS('--ink'));
  setCSS('--soft', state.soft || getCSS('--soft'));
  setCSS('--ring', state.ring);
  setCSS('--radius', state.radius+'px');
  setCSS('--fontScale', state.font);
  setCSS('--space', state.space);
  setCSS('--vignette', state.vignette);
  document.body.classList.remove('solid','none','glow'); document.body.classList.add(state.border);
  document.body.classList.toggle('has-gradient', state.bg.mode!=='video');
  document.body.classList.toggle('has-pattern', state.bg.mode==='pattern');
  renderBackground(); renderHero();

  // sync UI controls
  $('#uiAccent').value = state.accent;
  $('#uiAccent2').value = state.accent2;
  $('#uiInk').value = getCSS('--ink').trim() || '#e9ecf3';
  $('#uiSoft').value = getCSS('--soft').trim() || '#b9c0cf';
  $('#uiRing').value = state.ring;
  $('#uiRadius').value = state.radius;
  $('#uiFont').value = state.font;
  $('#uiSpace').value = state.space;
  $('#uiBorder').value = state.border;
  $('#uiVignette').value = state.vignette;
  $('#uiHero').value = state.heroSrc;
  $('#uiBgMode').value = state.bg.mode;
  $('#uiBgSrc').value = state.bg.src;
}

/* ---------- Start ---------- */
function start(){
  applyState();
  loadManifest();
  load();
}
window.addEventListener('DOMContentLoaded', start);
</script>
</body>
</html>
