{
  "ops": [
    {
      "op": "write",
      "path": ".github/workflows/sync-auto-pr.yml",
      "content": "name: Sync inventory & snapshot to branches\n\non:\n  schedule:\n    - cron: '15 2 * * *'  # nightly 02:15 UTC\n  workflow_dispatch:\n\nconcurrency:\n  group: sync-auto-pr\n  cancel-in-progress: false\n\njobs:\n  sync:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n      pull-requests: write\n    strategy:\n      matrix:\n        source: [dev-inventory, dev-snapshot]\n        target: [dev, main]\n    steps:\n      - name: Checkout (full history)\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n      - name: Fetch all branches\n        run: |\n          git fetch --prune --unshallow || true\n          git fetch origin +refs/heads/*:refs/remotes/origin/*\n      - name: Prepare working tree\n        run: |\n          set -e\n          git checkout origin/${{ matrix.target }} -B ${{ matrix.target }}\n          # Merge source into target; don't fail the job on non-fast-forward/conflictâ€”just open a PR with the merge commit\n          set +e\n          git merge --no-ff origin/${{ matrix.source }} -m \"chore(sync): merge ${{ matrix.source }} into ${{ matrix.target }}\" || true\n          set -e\n          # Detect no-op merge\n          if git diff --quiet HEAD; then\n            echo \"NO_CHANGES=true\" >> $GITHUB_ENV\n          fi\n      - name: Create PR when changes exist\n        if: env.NO_CHANGES != 'true'\n        uses: peter-evans/create-pull-request@v6\n        with:\n          commit-message: \"chore(sync): ${{ matrix.source }} -> ${{ matrix.target }}\"\n          title: \"chore(sync): ${{ matrix.source }} -> ${{ matrix.target }}\"\n          body: |\n            Automated nightly sync. This PR merges `${{ matrix.source }}` into `${{ matrix.target }}`.\n            Generated by `sync-auto-pr.yml`.\n          base: ${{ matrix.target }}\n          branch: auto/sync-${{ matrix.source }}-to-${{ matrix.target }}\n          delete-branch: true\n          labels: sync, automation\n"
    }
  ]
}
