{
  "ops": [
    {
      "op": "write",
      "path": ".github/workflows/build-file-inventory.yml",
      "content": "name: Build File Inventory\n\non:\n  push:\n    branches: [ main ]\n  workflow_dispatch:\n\npermissions:\n  contents: write\n\n# Prevent concurrent writers to main\nconcurrency:\n  group: autocommit-main\n  cancel-in-progress: false\n\njobs:\n  inventory:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Generate inventory\n        run: node scripts/gen-file-inventory.mjs\n        env:\n          INVENTORY_OUT_JSON: dev/dev/data/file-tree.json\n          INVENTORY_OUT_TXT: dev/dev/data/file-tree.txt\n          INVENTORY_METRICS: dev/dev/data/repo-metrics.json\n\n      - name: Rebase with remote\n        run: |\n          git fetch origin main\n          git rebase origin/main || git rebase --abort\n\n      - name: Auto-commit inventory\n        uses: stefanzweifel/git-auto-commit-action@v5\n        with:\n          repository: .\n          branch: main\n          file_pattern: dev/dev/data/file-tree.txt dev/dev/data/file-tree.json dev/dev/data/repo-metrics.json\n          commit_message: Update build-file-inventory (auto)\n          commit_user_name: github-actions[bot]\n          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com\n          commit_author: The-Grid111 <226302028+The-Grid111@users.noreply.github.com>\n          # Important bits\n          pull_strategy: REBASE\n          push_options: --force-with-lease\n"
    },
    {
      "op": "write",
      "path": ".github/workflows/repo-snapshot.yml",
      "content": "name: Repo Snapshot\n\non:\n  push:\n    branches: [ main ]\n  workflow_dispatch:\n\npermissions:\n  contents: write\n\n# Same concurrency group as inventory to serialize commits\nconcurrency:\n  group: autocommit-main\n  cancel-in-progress: false\n\njobs:\n  snapshot:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Create snapshot file\n        run: node scripts/repo-snapshot.mjs\n        env:\n          SNAPSHOT_OUT: dev/dev/archive/snapshot_$(date +%s).json\n\n      - name: Rebase with remote\n        run: |\n          git fetch origin main\n          git rebase origin/main || git rebase --abort\n\n      - name: Auto-commit snapshot\n        uses: stefanzweifel/git-auto-commit-action@v5\n        with:\n          repository: .\n          branch: main\n          file_pattern: dev/dev/archive/snapshot_*.json\n          commit_message: Repo snapshot (auto)\n          commit_user_name: github-actions[bot]\n          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com\n          commit_author: The-Grid111 <226302028+The-Grid111@users.noreply.github.com>\n          # Important bits\n          pull_strategy: REBASE\n          push_options: --force-with-lease\n"
    }
  ]
}
