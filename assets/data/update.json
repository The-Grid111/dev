{
  "ops": [
    {
      "op": "write",
      "path": ".github/workflows/repo-snapshot.yml",
      "content": "name: Repo Snapshot\n\non:\n  push:\n    branches: [ main ]\n    paths:\n      - 'assets/data/update.json'\n      - '.github/workflows/repo-snapshot.yml'\n      - 'scripts/repo-snapshot.mjs'\n  workflow_dispatch:\n\nconcurrency:\n  group: repo-snapshot-${{ github.ref }}\n  cancel-in-progress: false\n\njobs:\n  snapshot:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n\n    steps:\n      - name: Checkout (full history)\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n          persist-credentials: true\n\n      - name: Setup Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Generate snapshot\n        run: |\n          node scripts/repo-snapshot.mjs\n\n      - name: Pull latest main (rebase)\n        run: |\n          git config --global user.name \"github-actions[bot]\"\n          git config --global user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n          # Rebase to integrate any concurrent pushes before we commit\n          git pull --rebase origin main || true\n\n      - name: Auto-commit snapshot\n        uses: stefanzweifel/git-auto-commit-action@v5\n        with:\n          commit_message: \"Repo snapshot (auto)\"\n          file_pattern: |\n            dev/dev/archive/snapshot_*.json\n            dev/archive/snapshot_*.json\n          branch: main\n          commit_user_name: github-actions[bot]\n          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com\n          # With the rebase above, a normal push succeeds; this is a safe guard.\n          push_options: '--force-with-lease'\n"
    }
  ]
}
