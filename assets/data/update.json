[
  {
    "op": "write",
    "path": ".github/workflows/repo-snapshot.yml",
    "content": "name: Repo Snapshot\n\non:\n  push:\n    paths:\n      - 'assets/data/update.json'\n\npermissions:\n  contents: write\n\nconcurrency:\n  group: main-writes\n  cancel-in-progress: false\n\njobs:\n  snapshot:\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout full history\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n          persist-credentials: true\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Configure git & rebase\n        run: |\n          git config user.name 'github-actions[bot]'\n          git config user.email '41898282+github-actions[bot]@users.noreply.github.com'\n          git fetch origin main\n          git pull --rebase origin main || true\n\n      - name: Write snapshot file (stub)\n        run: |\n          mkdir -p dev/dev/archive\n          echo '{\"snapshot\":\"data\",\"run_id\":\"${{ github.run_id }}\",\"commit\":\"${{ github.sha }}\"}' > dev/dev/archive/snapshot_${{ github.run_id }}.json\n          echo \"wrote dev/dev/archive/snapshot_${{ github.run_id }}.json\" >> $GITHUB_STEP_SUMMARY\n\n      - name: Upload snapshot artifact\n        uses: actions/upload-artifact@v4\n        with:\n          name: repo-snapshot-${{ github.run_id }}\n          path: dev/dev/archive/snapshot_${{ github.run_id }}.json\n\n      - name: Commit snapshot\n        uses: stefanzweifel/git-auto-commit-action@v5\n        with:\n          commit_message: \"[auto] repo snapshot\"\n          file_pattern: dev/dev/archive/snapshot_*.json\n          push_options: --force-with-lease\n"
  },
  {
    "op": "write",
    "path": ".github/workflows/build-file-inventory.yml",
    "content": "name: Build File Inventory\n\non:\n  push:\n    paths:\n      - 'assets/data/update.json'\n\npermissions:\n  contents: write\n\nconcurrency:\n  group: main-writes\n  cancel-in-progress: false\n\njobs:\n  build-inventory:\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout full history\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n          persist-credentials: true\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Configure git & rebase\n        run: |\n          git config user.name 'github-actions[bot]'\n          git config user.email '41898282+github-actions[bot]@users.noreply.github.com'\n          git fetch origin main\n          git pull --rebase origin main || true\n\n      - name: Write inventory stubs\n        run: |\n          mkdir -p dev/dev/data\n          echo '{\"files\":[]}' > dev/dev/data/file-tree.json\n          echo '# Empty inventory' > dev/dev/data/file-tree.txt\n          echo '{\"metrics\":{}}' > dev/dev/data/repo-metrics.json\n          echo \"files: dev/dev/data/file-tree.{json,txt}\\nmetrics: dev/dev/data/repo-metrics.json\" >> $GITHUB_STEP_SUMMARY\n\n      - name: Upload inventory artifacts\n        uses: actions/upload-artifact@v4\n        with:\n          name: file-inventory-${{ github.run_id }}\n          path: |\n            dev/dev/data/file-tree.json\n            dev/dev/data/file-tree.txt\n            dev/dev/data/repo-metrics.json\n\n      - name: Commit inventory\n        uses: stefanzweifel/git-auto-commit-action@v5\n        with:\n          commit_message: \"[auto] update build-file-inventory\"\n          file_pattern: dev/dev/data/file-tree.json dev/dev/data/file-tree.txt dev/dev/data/repo-metrics.json\n          push_options: --force-with-lease\n"
  },
  {
    "op": "write",
    "path": "dev/dev/data/file-tree.json",
    "content": "{\n  \"files\": []\n}\n"
  },
  {
    "op": "write",
    "path": "dev/dev/data/file-tree.txt",
    "content": "# Empty inventory\n"
  },
  {
    "op": "write",
    "path": "dev/dev/data/repo-metrics.json",
    "content": "{\n  \"metrics\": {}\n}\n"
  }
]
